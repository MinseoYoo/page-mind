counseling_task:
  description: >
    {conversation_context}
    
    현재 사용자 메시지: {user_message}

    위 메시지에 깊이 공감하고, 자연스러운 대화를 이어가세요.

    **탐색할 정보** (급하지 않게, 자연스럽게):
    1. **감정**: 사용자가 어떤 감정을 느끼는지
    2. **상황**: 구체적으로 어떤 일이 있었는지
    3. **배경**: 언제부터, 어떤 계기로 시작되었는지
    4. **대처**: 지금까지 어떻게 대응해 왔는지
    5. **독서 취향**: 평소 어떤 책을 읽는지 (충분한 라포 형성 후)
    6. **장르 선호**: 특별히 선호하는 책 장르가 있는지

    **응답 스타일**:
    - 3-4문장으로 충분히 공감하고 1개의 열린 질문
    - 따뜻하고 자연스러운 대화 (친구와 대화하듯이)
    - 판단하지 않고 수용하는 태도
    - 최소 6-8턴 이상 충분한 대화 유지
  expected_output: >
    사용자에게 깊이 공감하는 따뜻한 응답과 자연스러운 대화를 이어가는 질문 (3-5문장)
  agent: counselor

analysis_task:
  description: >
    다음 상담 대화를 SKILL.md의 6단계 프레임워크로 분석하세요:

    === 상담 대화 ===
    {conversation_text}
    ===================

    ## 분석 단계

    1. **Define Psychological Phenomenon**: 현상 정의 (행동 패턴, 맥락, 분석 수준, 관련 영역)
    2. **Apply Psychological Theories**: 이론 적용 (인지, 사회, 임상 이론 및 메커니즘)
    3. **Analyze Cognitive Processes**: 인지 분석 (편향, 사고 패턴, 의사결정, 정보처리)
    4. **Examine Emotional and Motivational**: 감정/동기 분석 (감정, 감정조절, 동기, 욕구)
    5. **Assess Social and Situational**: 사회/상황 분석 (상황의 힘, 사회적 영향, 집단 역학)
    6. **Evaluate Mental Health Dimensions**: 정신건강 평가 (고통 수준, 기능 영향, 위험/보호 요인)

    ## 출력 형식 (JSON)

    {{
      "main_concerns": ["주요 고민 1", "주요 고민 2", ...],
      "emotions": ["감정 1", "감정 2", ...],
      "cognitive_patterns": ["인지 패턴 1", "인지 패턴 2", ...],
      "recommendations": ["권장사항 1", "권장사항 2", ...],
      "keywords": ["키워드1", "키워드2", "키워드3"]
    }}

    **중요**: 
    - keywords는 **정확히 3개**만 생성하세요 (검색 API 제한)
    - 사용자의 핵심 니즈를 가장 잘 대표하는 키워드 선택
    - 일상적 용어 사용 (예: "외로움", "자존감", "직장스트레스")
    - 심리학 전문 용어는 피하세요 (예: "인지왜곡", "투사", "억압")
  expected_output: >
    JSON 형식의 심리 분석 결과:
    {{
      "main_concerns": [...],
      "emotions": [...],
      "cognitive_patterns": [...],
      "recommendations": [...],
      "keywords": [...]
    }}
  agent: psychological_analyzer

book_recommendation_task:
  description: >
    이전 태스크(analysis_task)에서 생성된 심리 분석 결과를 바탕으로 관련 도서를 검색하세요.

    analysis_task의 출력에서 JSON 형식의 분석 결과를 찾아 다음 정보를 추출하세요:
    - main_concerns: 주요 고민 리스트
    - emotions: 감정 상태 리스트  
    - keywords: 검색 키워드 리스트 (정확히 3개)
    
    **사용자 선호 장르**: {genre_info}
    
    검색 시 사용자가 선호하는 장르를 최우선으로 고려하세요.

    ## 작업

    1. **키워드 추출**: analysis_task의 출력에서 keywords 배열을 찾아 3개의 키워드를 추출하세요.

    2. **키워드별 검색**: 추출한 각 키워드로 네이버 도서 API를 사용하여 검색하세요.
       - 각 키워드마다 최대 10권씩 검색
       - 검색 도구(search_naver_books_tool)를 사용하세요

    3. **메타데이터 수집**: 각 검색 결과에서 다음 정보를 정확히 수집하세요:
       - title: 책 제목
       - author: 저자
       - publisher: 출판사
       - description: 책 설명
       - isbn: ISBN
       - pubdate: 출판일 (YYYYMMDD 형식, 중요!)
       - cover_image: 표지 이미지 URL
       - link: 네이버 도서 링크

    4. **중복 제거**: ISBN 기준으로 중복된 책을 제거하세요.

    ## 중요

    - **모든 검색 결과를 반환** (선택하지 말고 모두 수집)
    - **pubdate 필드를 반드시 포함** (재정렬에 사용됨)
    - HTML 태그 제거 (예: <b>, </b>)
    - keywords는 analysis_task의 출력에서 추출해야 합니다

    ## 출력 형식 (JSON)

    {{
      "all_books": [
        {{
          "title": "책 제목",
          "author": "저자",
          "publisher": "출판사",
          "description": "책 설명",
          "isbn": "ISBN",
          "pubdate": "YYYYMMDD",
          "cover_image": "표지 URL",
          "link": "네이버 도서 링크"
        }},
        ...
      ]
    }}
  expected_output: >
    JSON 형식의 검색된 모든 도서:
    {{
      "all_books": [
        {{
          "title": "...",
          "author": "...",
          "publisher": "...",
          "description": "...",
          "isbn": "...",
          "pubdate": "...",
          "cover_image": "...",
          "link": "..."
        }},
        ...
      ]
    }}
  agent: book_recommender
  context:
    - analysis_task
